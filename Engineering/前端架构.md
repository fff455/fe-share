# 前端架构

## 前端架构总览

软件架构，贯穿软件的生命周期，一个完整的软件架构设计应该自上而下处理好：

- 系统间的关系，系统与其他系统是调用还是依赖关系
- 系统内的关系，如前端和后端，是以怎样的方式进行通信
- 应用内架构，包含应用相关的框架/组件
- 规范和原则，用于指导具体的代码编写

最初，前端是没有架构的，因为功能简单的代码没有架构可言。前端开发的发展历史可以分为如下几个阶段：

1. 古典时期，后端渲染出 HTML，前端用 CSS 进行简单的辅助
2. 动效时期，前端开始编写 JS，进行动画效果的制作
3. Ajax 通信时期，标志性事件是 2005 年 Google 在 Google Map 中首次使用异步通信的技术，开启了前端的新时代。一旦使用了异步通信，就意味着前端在运行时是需要动态渲染的。这时候，开发着需要做两件事：
   - 动态生成 HTML。后端返回 HTML，前端进行动态替换
   - 模板分离。后端 API 返回前端所需要的数据，前端通过模板引擎（Mustache 等）渲染 HTML
4. 借鉴后端的 MVC 架构，前端诞生了一系列早期的 MVC 框架，如 Backbone/Knockout 等
5. 在 Node.js 问世之后，前端的软件工程不断改善：
   - 构建工具：Gulp/Grunt 等
   - 包管理：NPM/Bower 等
   - 模块管理：Common.js/AMD 等
6. 随着单页应用的流行，前后端分离架构成为标准实践，前端考虑的内容越来越多：
   - API 管理：Swagger API 管理工具以及 Mock Server 成为标准实践
   - 大前端：前端实现跨平台跨端移动应用框架，如 Ionic，React Native，Flutter 等
   - 组件化：前端开始由组件构成，而非页面
7. 在 MVC 框架，React/Vue 等 MV\*的框架外，出现了微前端的概念，它解决了如下问题：
   - 跨框架，同一个页面可以运行多个框架
   - 拆分应用，复杂的应用拆分成细小的应用
   - 系统迁移，遗留的系统可以嵌入新系统运行

针对前端的系统分层，自上而下有以下层次的设计：

1. 系统级
   前后端分离架构设计，微前端架构设计
2. 应用级
   组件库，脚手架，设计库
3. 模块级
   组件化，模块化设计
4. 代码级
   规范，原则，质量

## 项目技术架构实施

项目的技术周期分为三个阶段：

1. 技术准备期  
   这个阶段，技术第一，业务第二。主要需要完成 3 个任务： - 架构设计 - 概念验证(PoC)：快速搭建与业务无关的示例代码，验证架构可行 - 迭代 0：搭建完整环境，更细粒度的技术选型，脚手架/代码库/CI/CD/权限
2. 业务回补期  
   业务开发过程正常，开始追回之前的业务累积，对应第一次业务的 DDL。这一阶段意味着技术上可能存在的调整有； - 测试策略调整，调低覆盖率，之后补回，加快开发速度 - 验证部署 - 提升团队能力：技术分享/WorkShop/结对编程/对外输出
3. 成长优化期  
   建立多次上线，业务开发流程相对固定，开始偿还技术债务：代码质量/测试覆盖率/依赖问题

## 工作流设计

工作流即我们开发过程中的流程和规范。具体的有如下几点：

1. 代码结构  
   代码结构是我们项目文件夹组织结构以及必要的文档介绍。对于前端项目来说，我们进入项目，能够： - 通过 README 阅读相关资料，一份好的 README 应该包含支持运行的环境/必要的依赖准备/如何搭建/安装指南/线上示例或线上地址/相关文档链接/相关人员，讨论群 - package.json 了解项目依赖/组件库/构建脚本 - 浏览配置目录（或文件）信息 - 阅读具体代码

2. 代码风格  
   前端项目中涉及代码风格的配置比较多，比较常用的有 Prettier/ESLint/CSSLint 以及编辑器的配置信息等。在多人协作的项目中，需要对这些规范进行强制性规范。这样的好处一来是能够统一项目代码风格，对新手阅读代码更加友好；二来是可以避免代码提交时来回产生不必要的 diff。

3. 架构图  
   对于架构复杂的系统而言，架构图必不可少

4. 代码提交规范

   - 版本管理工具（Git/SVN）统一
   - 提交信息需要规范
   - 为代码添加 pre-commit 检查：检查工作流是否存在不符合规范的行为

5. 测试策略
   对于 Web 应用的测试层级，自底向下有以下 4 层：

   - 单元测试
     选定单元测试框架，创建测试规则，指定测试覆盖率最小值
   - 组件测试
     功能测试，行为测试
   - 接口测试
     后端验证 API 是否与 Mock 数据统一，前端验证 Mock 数据或 API 是否满足前端需求
   - E2E 测试
     模仿用户行为，测试参数、参数类型、参数值、参数数量、返回值、抛出错误等，保证系统能够在任何情况下都稳定可靠完成工作

## 构建流设计

构建系统能够帮助开发者从系统的源代码构建出来可部署的软件。前端的构建系统需要处理如下问题：

1. 依赖管理工具  
   不同的模块化管理对应着不同的依赖管理工具； - AMD：Bower - CommonJS：NPM/Yarn
2. 包源管理  
   根据开发/组织的实际情况选择： - 公有/私有的包管理（NPM）源 - 源码版本管理器（Git）
3. 代码打包  
   在打包过程中，前端系统大部分的打包过程都交给相应的框架 CLI 进行打包
4. 构建流设计  
   设计构建流需要根据前端使用的框架/开发经验/框架脚手架功能进行设计，需要考虑的有如下几点：
   - 根据构建的复杂度选用不同的构建工具：Webpack（模块化打包）/Gulp/Grunt（复杂的项目工作流构建）或者直接使用 NPM（脚本简单的应用构建）
   - 步骤拆解：对于复杂的构建步骤（build），对其进行拆解，拆分出多个子命令
   - 自动化任务
5. CD  
   前端代码部署有 3 种方式：
   - 持续部署，构建完成即部署，常见于测试环境
   - 自动化部署，人为介入完成部署
   - 手动部署

## 多页应用设计

## 单页应用设计

## 组件化设计

## 前后端分离架构设计

## 微前端架构设计

## 演进式架构
